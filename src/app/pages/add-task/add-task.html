<section class="add-task" [class.modal-mode]="isModal()" [class.edit-mode]="taskToEdit()">
	@if(!taskToEdit()) {
	<h1>Add Task</h1>
	}
	<ng-content></ng-content>


	<form [formGroup]="taskForm" (ngSubmit)="onSubmit()" class="task-form">
		<div class="task-form__content">
			<!-- Left Column -->
			<div class="task-form__column">
				<!-- Title Field -->
				<div class="form-group">
					<label for="title">Title
						@if(!taskToEdit()) {
							<span class="required">*</span>
						}
					</label>
					<input
						id="title"
						type="text"
						formControlName="title"
						placeholder="Enter a title"
						[class.invalid]="taskForm.get('title')?.invalid && taskForm.get('title')?.touched"
					/>
					@if (getErrorMessage('title')) {
						<span class="error-message">{{ getErrorMessage('title') }}</span>
					}
				</div>

				<!-- Description Field -->
				<div class="form-group">
					<label for="description">Description</label>
					<textarea
						id="description"
						formControlName="description"
						placeholder="Enter a Description"
						rows="4"
					></textarea>
				</div>

				<!-- Due Date Field -->
				<div class="form-group">
					<label for="dueDate">Due date
						@if(!taskToEdit()) {
							<span class="required">*</span>
						}
					</label>
					<app-date-picker
						[selectedDate]="taskForm.get('dueDate')?.value"
						[isInvalid]="!!(taskForm.get('dueDate')?.invalid && taskForm.get('dueDate')?.touched)"
						(dateSelected)="onDateSelected($event)"
					></app-date-picker>
					@if (getErrorMessage('dueDate')) {
						<span class="error-message">{{ getErrorMessage('dueDate') }}</span>
					}
				</div>
			</div>

			<!-- Divider -->
			<div class="task-form__divider"></div>

			<!-- Right Column -->
			<div class="task-form__column">
				<!-- Priority Field -->
				<div class="form-group">
					<label>Priority</label>
					<app-priority-buttons
						[selectedPriority]="taskForm.get('priority')?.value"
						(prioritySelected)="onPrioritySelected($event)"
					></app-priority-buttons>
				</div>

				<!-- Assigned To Field -->
				<div class="form-group">
					<label>Assigned to</label>
					<app-contact-assignment
						[selectedContacts]="selectedContacts()"
						(contactsChanged)="onContactsChanged($event)"
					></app-contact-assignment>
				</div>

				<!-- Category Field -->
				<div class="form-group">
					<label>Category
						@if(!taskToEdit()) {
						<span class="required">*</span>
						}
					</label>
					<app-category-select
						[selectedCategory]="taskForm.get('category')?.value"
						[isInvalid]="!!(taskForm.get('category')?.invalid && taskForm.get('category')?.touched)"
						(categorySelected)="onCategorySelected($event)"
					></app-category-select>
					@if (getErrorMessage('category')) {
						<span class="error-message">{{ getErrorMessage('category') }}</span>
					}
				</div>

				<!-- Subtasks Field -->
				<div class="form-group">
					<label>Subtasks</label>
					<app-subtask-management
						[subtasks]="subtasks()"
						(subtasksChanged)="onSubtasksChanged($event)"
					></app-subtask-management>
				</div>
			</div>
		</div>

		<!-- Form Actions -->
		<div class="task-form__actions">
			@if (!taskToEdit()) {
				<p class="required-hint"><span class="required">*</span>This field is required</p>
			} @else {
				<div></div>
			}
			<div class="buttons">
				@if (!taskToEdit()) {
					<button type="button" class="btn-clear" (click)="clearForm()">
						<span>Clear</span>
						<img src="icons/close_icon2.svg" alt="clear" />
					</button>
				}
				<button
					type="submit"
					class="btn-create"
					[disabled]="isSaving()"
				>
					<span>{{ isSaving() ? (taskToEdit() ? 'Saving...' : 'Creating...') : (taskToEdit() ? 'Ok' : 'Create Task') }}</span>
						<img src="icons/check.svg" alt="create" />
				</button>
			</div>
		</div>
	</form>
</section>
